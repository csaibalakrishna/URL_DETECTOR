<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis Results - URL Security Analyzer</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h1 class="h2 mb-1">
                            <i class="fas fa-shield-alt me-2"></i>Security Analysis Results
                        </h1>
                        <p class="text-muted mb-0">Comprehensive security assessment completed</p>
                    </div>
                    <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Analyze Another URL
                    </a>
                </div>
            </div>
        </div>

        <!-- URL Info -->
        <div class="row justify-content-center mb-4">
            <div class="col-lg-10">
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-4">
                        <h6 class="text-muted mb-2">Analyzed URL</h6>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-link text-primary me-3"></i>
                            <code class="fs-6">{{ results.url }}</code>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Risk Assessment -->
        <div class="row justify-content-center mb-4">
            <div class="col-lg-10">
                <div class="card border-0 shadow">
                    <div class="card-body p-4">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h5 class="mb-2">
                                    <i class="fas fa-exclamation-triangle me-2"></i>Risk Assessment
                                </h5>
                                <div class="d-flex align-items-center mb-2">
                                    <span class="badge bg-{{ results.risk_level.class }} fs-6 me-3">
                                        {{ results.risk_level.level }} Risk
                                    </span>
                                    <span class="text-muted">{{ results.risk_level.description }}</span>
                                </div>
                                <p class="mb-0">
                                    <strong>Classification:</strong> {{ results.prediction.classification }}
                                    <span class="text-muted ms-2">
                                        ({{ "%.1f"|format(results.prediction.probability * 100) }}% confidence)
                                    </span>
                                </p>
                            </div>
                            <div class="col-md-4 text-center">
                                <div class="risk-score">
                                    <div class="risk-circle bg-{{ results.risk_level.class }}">
                                        {{ "%.0f"|format(results.prediction.probability * 100) }}%
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Feature Analysis -->
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card border-0 shadow">
                    <div class="card-header bg-transparent border-0 p-4">
                        <h5 class="mb-0">
                            <i class="fas fa-list-check me-2"></i>Detailed Feature Analysis
                        </h5>
                        <p class="text-muted mb-0 mt-2">
                            {{ results.features|length - 2 }} security features analyzed
                        </p>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="px-4 py-3">Feature</th>
                                        <th class="px-4 py-3">Value</th>
                                        <th class="px-4 py-3">Status</th>
                                        <th class="px-4 py-3">Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for feature, value in results.features.items() %}
                                        {% if feature not in ['Index', 'class'] %}
                                            <tr>
                                                <td class="px-4 py-3">
                                                    <strong>{{ feature.replace('_', ' ').title() }}</strong>
                                                </td>
                                                <td class="px-4 py-3">
                                                    <code>{{ value }}</code>
                                                </td>
                                                <td class="px-4 py-3">
                                                    {% if value == 0 %}
                                                        <span class="badge bg-success">
                                                            <i class="fas fa-check me-1"></i>Safe
                                                        </span>
                                                    {% elif value == 1 %}
                                                        <span class="badge bg-warning">
                                                            <i class="fas fa-exclamation me-1"></i>Suspicious
                                                        </span>
                                                    {% else %}
                                                        <span class="badge bg-danger">
                                                            <i class="fas fa-times me-1"></i>High Risk
                                                        </span>
                                                    {% endif %}
                                                </td>
                                                <td class="px-4 py-3 text-muted">
                                                    {{ results.feature_explanations.get(feature, 'Security feature analysis') }}
                                                </td>
                                            </tr>
                                        {% endif %}
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Feature Importance -->
        {% if results.prediction.feature_importance %}
        <div class="row justify-content-center mt-4">
            <div class="col-lg-10">
                <div class="card border-0 shadow">
                    <div class="card-header bg-transparent border-0 p-4">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-bar me-2"></i>Feature Importance
                        </h5>
                        <p class="text-muted mb-0 mt-2">
                            Most influential features in this classification
                        </p>
                    </div>
                    <div class="card-body p-4">
                        <div class="row">
                            {% for feature, importance in results.prediction.feature_importance.items() %}
                                {% if loop.index <= 10 %}
                                    <div class="col-md-6 mb-3">
                                        <div class="d-flex justify-content-between align-items-center mb-1">
                                            <span class="small fw-medium">{{ feature.replace('_', ' ').title() }}</span>
                                            <span class="small text-muted">{{ "%.3f"|format(importance) }}</span>
                                        </div>
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-primary" 
                                                 style="width: {{ (importance * 100)|round }}%"></div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Export Options -->
        <div class="row justify-content-center mt-4">
            <div class="col-lg-10">
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-4">
                        <h6 class="mb-3">
                            <i class="fas fa-download me-2"></i>Export Results
                        </h6>
                        <div class="d-flex gap-2 flex-wrap">
                            <button class="btn btn-outline-primary btn-sm" onclick="exportResults('json')">
                                <i class="fas fa-code me-1"></i>Export as JSON
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="exportResults('csv')">
                                <i class="fas fa-table me-1"></i>Export as CSV
                            </button>
                            <button class="btn btn-outline-info btn-sm" onclick="printResults()">
                                <i class="fas fa-print me-1"></i>Print Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="row justify-content-center mt-5">
            <div class="col-lg-10">
                <div class="text-center text-muted">
                    <p class="mb-0">
                        <i class="fas fa-shield-check me-1"></i>
                        Analysis completed successfully
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // Export functionality
        function exportResults(format) {
            const results = {{ results|tojson }};
            
            if (format === 'json') {
                const blob = new Blob([JSON.stringify(results, null, 2)], {type: 'application/json'});
                downloadFile(blob, 'url-analysis-results.json');
            } else if (format === 'csv') {
                let csv = 'Feature,Value,Status\n';
                for (const [feature, value] of Object.entries(results.features)) {
                    if (feature !== 'Index' && feature !== 'class') {
                        const status = value === 0 ? 'Safe' : value === 1 ? 'Suspicious' : 'High Risk';
                        csv += `"${feature}","${value}","${status}"\n`;
                    }
                }
                const blob = new Blob([csv], {type: 'text/csv'});
                downloadFile(blob, 'url-analysis-results.csv');
            }
        }
        
        function downloadFile(blob, filename) {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        
        function printResults() {
            window.print();
        }
        
        // Smooth scroll for anchors
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>
